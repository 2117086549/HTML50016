var scene={intro:function(){$("#settings, #button, #switch_sound").addClass("dim");$("#intro").empty();$("<div/>",{id:"white"}).appendTo("#intro").animate({opacity:1},1e3,function(){$("<span/>",{id:"message_1","class":"message"}).appendTo("#intro").text("Hey!").hide().fadeIn(1e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_2","class":"message"}).appendTo("#intro").text("Hello!").hide().fadeIn(2e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_3","class":"message"}).appendTo("#intro").text("I hope he's alive...").hide().fadeIn(5e3).fadeOut(5e3);$("<span/>",{id:"message_4","class":"message player"}).appendTo("#intro").text("What?!").hide().fadeIn(500).fadeOut(5e3,function(){$("<span/>",{id:"message_5","class":"message player"}).appendTo("#intro").text("What's going on?!").hide().fadeIn(500).fadeOut(4e3,function(){$("#settings, #button, #switch_sound").removeClass("dim");game.room(5,6)})})})})})},corridor:function(){function a(){var a=$(window).width(),b=$(window).height();sound_scene_corridor.play();setTimeout(function(){$("#corridor").animate({left:a/2-150,top:b/2-744},5e3);$(room.player_body()).css("background-position","-620px 0")},1e3);setTimeout(function(){$("<span/>",{id:"message_1","class":"message"}).appendTo("#corridor").text("Come downstairs...").hide().fadeIn(1e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_2","class":"message"}).appendTo("#corridor").text("NOW!").hide().fadeIn(1e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_3","class":"message"}).appendTo("#corridor").text("Merge with me.").hide().fadeIn(1e3).fadeOut(2e3,function(){room.center(!0,5e3);var a=$.jStorage.get("played");a.push("scene_corridor");$.jStorage.set("played",a);setTimeout(function(){$("#settings, #button, #switch_sound").removeClass("dim");scene.no_click(!1)},5e3)})})})},6500)}if($.inArray("scene_corridor",played)===-1){$("#settings, #button, #switch_sound").addClass("dim");scene.no_click(!0);setTimeout(function(){a()},2e3)}},corridor_phone:function(){scene.no_click(!0);sound_scene_corridor_phone.play();var a=2e3,b=3500,c=1e4;$("#phone, #phone_mask, #phone_shadow").fadeOut(a);setTimeout(function(){$("#hidden_door").animate({height:246},c)},a+b);setTimeout(function(){var a=$.jStorage.get("played");a.push("scene_corridor_phone");$.jStorage.set("played",a);scene.no_click(!1)},a+b+c)},bathroom_shower:function(){sound_shower_curtain.play();sound_scary.play();room.the_player.go_to.start({target:"3-7"});setTimeout(function(){$("#player").text_cloud("WHAT the...!?",2e3);$("#sprite").css("background-position","-310px 0")},400);$("#curtain").css("opacity",0);$("#curtain_folded").css("opacity",1);$('<div id="dark_character" />').appendTo("#floor").sprite({no_of_frames:7}).delay(2e3).animate({opacity:0},500);$('<div id="bathroom_overlay" />').appendTo("#bathroom").animate({opacity:0},2500,"linear");setTimeout(function(){$("#curtain_use").remove();$("#dark_character, #bathroom_overlay").remove();soundManager.stop("sound_scary");var a=$.jStorage.get("played");a.push("scene_shower");$.jStorage.set("played",a)},2500)},mirror:function(){var a=$("#lightbox");a.fadeIn().load("bathroom_reflection.html",function(){var b=$("#reflection"),c=$("#reflection_flicker"),d=$("#reflection_glow");face=$("#face");var e=function(a,c,d){b.find(".first").hover(function(){$(this).children("div").css({opacity:"1"});var a=$(this);setTimeout(function(){a.next().children().css({opacity:"1"})},200)},function(){var a=$(this);setTimeout(function(){a.children().css({opacity:"0"})},2e3);setTimeout(function(){a.next().children().css({opacity:"0"})},3e3)})},f=function(a,b,c){width=a.width(),height=a.height(),tile_width=width/b,tile_height=height/c;for(i=0;i<width/tile_width;i++)for(j=0;j<width/tile_width;j++){$('<div id="'+i+"-"+j+'" class="ref_tile" />').attr("data-x",i).attr("data-y",j).appendTo(a).css({width:tile_width,height:tile_height,left:tile_width*i,top:tile_height*j}).append('<div class="first"><div>').append('<div class="second"><div>').children("div").children("div").css({"background-position":-i*tile_width+"px "+ -j*tile_height+"px"});i===width/tile_width-1&&j===width/tile_height-1&&e()}};f(face,10,10);var g=function(){window.timer=setTimeout(function(){c.css("opacity","1");window.timer=setTimeout(function(){c.css("opacity","0");g()},(Math.random()*1+1)*100)},(Math.random()*1+1)*100)},h=function(){window.timer=setTimeout(function(){face.css("-webkit-transform","rotate(.1deg)");window.timer=setTimeout(function(){face.css("-webkit-transform","rotate(-.1deg)");h()},(Math.random()*5+5)*100)},(Math.random()*5+5)*100)};h();g();a.on("click",".close",function(){b.remove();clearInterval(window.timer);a.fadeOut()})})},bathroom_void_shower:function(){scene.no_click(!0,"rgba(0, 0, 0, .3)");$("#settings, #button, #switch_sound").addClass("dim");game.bathroom_setup();var a=$("#player"),b=$("#sprite"),c=$("#bathroom"),d=$("#faux_player"),e=$('<div id="dark_character" />').appendTo("#floor").hide();setTimeout(function(){b.css("background-position","-310px 0");c.css({left:$(window).width()/2-100,top:$(window).height()/2-260});var f=$('<div id="bathroom_overlay" />').appendTo("#bathroom").css("z-index",1e3);d.text_cloud("!!!",1e3);setTimeout(function(){sound_screech2.play();d.css("background-image","url(images/void_merge.png)").sprite({fps:12,no_of_frames:12,play_frames:12}).delay(1e3).fadeOut(500);setTimeout(function(){f.animate({opacity:0},2500,"linear",function(){$(this).remove()})},1e3);setTimeout(function(){sound_shower_curtain.play();$("#curtain").css("opacity",0);$("#curtain_folded").css("opacity",1);room.the_player.go_to.start({target:"3-7",action:function(){a.text_cloud("WHAT the...!?",2e3);b.css("background-position","-310px 0")}})},500);e.sprite({no_of_frames:7}).delay(1e3).fadeIn(500).delay(1e3).fadeOut(500);setTimeout(function(){f.fadeOut(500);scene.no_click(!1);$("#settings, #button, #switch_sound").removeClass("dim");var a=$.jStorage.get("played");a.push("scene_void_shower");$.jStorage.set("played",a)},1e3)},1500)},100);if($.inArray("scene_computer",played)!==-1){$computer.addClass("off");$("#computer_use").attr("data-tooltip","It doesn't work anymore...").css("cursor","help")}},release:function(){var a=function(a,b){a.animate({left:$(window).width()/2,top:300},2e3);$("#opened").remove();b.find("#sprite").css("opacity",0).after('<div id="opened" />');$(".tile, #exit").css("display","none");window.repeat_wobble=!0;var c=function(a,b,d,e){if(!b)var b=4;if(!d)var d=500;a.transition({x:Math.random()*b+1,y:Math.random()*b+1},d).transition({x:3,y:-2},d,function(){e?c(a,b,d,e):window.repeat_wobble&&c(a,b,d,e)})};a.sprite({no_of_frames:4}).fps(8).spStop().spStart();c(a,100,1e3);c($("#opened"),4,500,!0);var d=$("#diamond"),e=function(){d.animate({opacity:0},500).animate({opacity:1},500,function(){e()})};e();d.text_cloud("It's coming!",1500);setTimeout(function(){a.text_cloud("Show me the way to him.",3e3)},4e3)},b=function(a,b){window.repeat_wobble=!1;scene.no_click(!0);room.center(!0,2e3);a.animate({left:$(window).width()/2-50,top:$(window).height()/2-150},2e3,function(){sound_woosh.play();$('<div id="flash" />').appendTo("#opened").transition({scale:40,opacity:.7},2e3).transition({scale:1e3,opacity:1},500,function(){a.remove();$("#opened").animate({opacity:0},1e3,function(){$(this).remove()});b.find("#sprite").animate({opacity:1},function(){scene.no_click(!1);$("#entrance, #entrance_use").fadeIn("slow");$("#diamond").hide();var a=$.jStorage.get("played");a.push("scene_unite");$.jStorage.set("played",a);b.text_cloud("I feel... Kind of... Better now.","2000")});$("div.tile, #exit").css("display","block")})})};setTimeout(function(){var c=$("#player"),d=$("#fridge"),e=d.offset(),f=e.top,g=!1,h=$('<div id="fly" />').appendTo("body");d.on("drag",function(b,e){var i=d.offset(),j=f-i.top;if(j<-700&&!g){g=!0;window.is_ready=!0;a(h,c)}}).on("dragstop",function(a,e){var g=d.offset(),i=f-g.top,j=c.offset();if(window.is_ready&&i>-300){window.is_ready=!1;b(h,c)}})},1e3)},fish_unite:function(a){var b=$("#the_game");$("body").css("background","#c2deeb");b.empty().load("outside_view.html",function(){$.inArray("scene_furnace",played)===-1&&$("#tree").removeClass("leaves");if(a){var b=$('<div id="outside_corridor" />').appendTo("#outside_view");b.append('<div id="switch" />').append('<div id="player_sprite" />').append('<div id="player_shadow" />');b.hide();var c=function(a,b,d,e){if(!b)var b=4;if(!d)var d=500;a.transition({x:Math.random()*b+1,y:Math.random()*b+1},d).transition({x:3,y:-2},d,function(){c(a,b,d,e)})},d=$("#fish");d.sprite({no_of_frames:5}).spState(2).fps(8).spStop().spStart();var e=function(a){a.animate({left:536,top:275},5e3,"linear",function(){a.spState(3)}).animate({left:328,top:395},5e3,"linear",function(){if(!window.test){a.spState(2);e(a)}})};e(d);setTimeout(function(){d.text_cloud("It's so nice outside!",2e3)},1e3);setTimeout(function(){d.stop(!0).animate({left:550,top:320},1e3,function(){d.spState(1).text_cloud("Thank you man!",2e3);b.fadeIn(1e3);$("#tree").fadeOut(1e3);$("body").animate({backgroundColor:"#000000"},1e3);c($("#player_sprite"),4,500);setTimeout(function(){d.animate({left:"+=100",top:"+=80"},700).animate({left:440,top:230},300);setTimeout(function(){sound_woosh.play();$('<div id="flash" />').appendTo(d).transition({scale:40,opacity:.7},2e3).transition({scale:100,opacity:1},500,function(){var a=$.jStorage.get("played");a.push("scene_outside");$.jStorage.set("played",a);setTimeout(function(){$("#player").text_cloud("What was that?!",2e3)},3e3);setTimeout(function(){$("#player").text_cloud("Was it real?",2e3)},8e3);game.hidden_corridor(2,6)})},850)},1500)})},5200)}else{$("#fish").remove();$('<div class="close" />').appendTo("body").click(function(){$(this).animate({opacity:0},500,function(){$(this).remove()});game.hidden_corridor(2,6)})}})},explosion:function(){if($.inArray("scene_explosion",played)===-1){scene.no_click(!0);sound_explosion.play();room.the_player.go_to.start({target:"5-1"});$("#the_game").children("div").animate({left:"-=5"},50).animate({left:"+=5",top:"-=10"},50).animate({left:"-=3",top:"+=4"},50).animate({left:"+=2",top:"-=6"},50).animate({left:"-=10",top:"-=6"},50).animate({left:"-=5"},50).animate({left:"+=5",top:"-=10"},50).animate({left:"-=3",top:"+=4"},50).animate({left:"+=2",top:"-=6"},50).animate({left:"-=10",top:"-=6"},50).animate({left:"-=5"},50).animate({left:"-=5",top:"+=10"},50).animate({left:"+=3",top:"-=4"},50).animate({left:"-=2",top:"+=6"},50).animate({left:"+=10",top:"+=6"},50).animate({left:"+=5"},50).animate({left:"-=5",top:"+=10"},50).animate({left:"+=3",top:"-=4"},50).animate({left:"-=2",top:"+=6"},50).animate({left:"+=10",top:"+=6"},50).animate({left:"-=4",top:"+=2"},50);setTimeout(function(){scene.no_click(!1);var a=$.jStorage.get("played");a.push("scene_explosion");$.jStorage.set("played",a)},1100)}},cabin:function(){$.jStorage.set("is_in","cabin");$("<div/>",{id:"black"}).appendTo("body").css("opacity",1).animate({opacity:0},2e3,function(){$("body").find("#black").remove()});$("#the_game").empty().load("cabin.html",function(){$("#cabin").pan({fps:30,speed:.2,dir:"right"});var a=$("#faux_player");setTimeout(function(){a.sprite({fps:4,no_of_frames:12,play_frames:4}).text_cloud("Huh?",500)},2e3);setTimeout(function(){var b=$("#ticket_inspector");b.sprite({fps:8,no_of_frames:8}).animate({opacity:1},200);b.animate({left:138,top:70},1e3,"linear",function(){$(this).spStop(!0).spState(2);setTimeout(function(){sound_sliding_door.play();$("#door").animate({left:-67,top:-40},500,function(){b.text_cloud("Your stop is next.",2e3);setTimeout(function(){b.text_cloud("You have to leave the train.",2e3)},2e3);setTimeout(function(){a.text_cloud("...",1e3)},1e3);setTimeout(function(){a.addClass("stand-up").sprite({fps:8,no_of_frames:12,play_frames:8});setTimeout(function(){b.spState(1).spStart().animate({left:-42,top:-30},1e3);setTimeout(function(){a.text_cloud("OK...",99999);b.animate({opacity:0},200);$("#cabin").animate({opacity:0},3e3,function(){game.train(2,2)})},800)},2500)},2e3)})},500)})},4e3)})},darkness1:function(){var a=function(){var a=$("#last_corridor"),b=$("#darkness").find(".text"),c=$("#settings, #button, #switch_sound"),d=$(window).width(),e=$(window).height();c.addClass("dim");scene.no_click(!0,"rgba(0, 0, 0, .3)");setTimeout(function(){a.animate({left:d/2-1e3,top:e/2-500},5e3,function(){sound_darkness.play();b.text("Fssssssss").animate({opacity:1},500);setTimeout(function(){b.animate({opacity:0},1e3);room.center(!0,5e3);setTimeout(function(){scene.no_click(!1);c.removeClass("dim");var a=$.jStorage.get("played");a.push("darkness1");$.jStorage.set("played",a)},5e3)},1e3)})},500)};$.inArray("darkness1",played)===-1&&a()},darkness2:function(){var a=function(){var a=$("#sprite"),b=$("#last_corridor"),c=$("#darkness").find(".text"),d=$("#settings, #button, #switch_sound"),e=$(window).width(),f=$(window).height();d.addClass("dim");scene.no_click(!0,"rgba(0, 0, 0, .3)");setTimeout(function(){a.css("background-position","-620px 0");setTimeout(function(){b.animate({left:e/2-800,top:f/2-1e3},5e3,function(){sound_darkness.play();c.text("Leave me alone!").animate({opacity:1},500);setTimeout(function(){c.animate({opacity:0},1e3);room.center(!0,5e3);setTimeout(function(){scene.no_click(!1);d.removeClass("dim")},5e3)},1e3)})},1e3)},500)};a()},darkness3:function(){var a=$("#dark_player");scene.no_click(!0,"rgba(0, 0, 0, .3)");sound_absorbing.play();setTimeout(function(){a.sprite({fps:4,no_of_frames:5,play_frames:5})},4e3);a.animate({opacity:1},5e3,function(){room.the_player.go_to.start({target:"2-40",action:function(){var a=$("#floor"),b=$("#player"),c=$("#dark_player"),d=$("#fluorescent_1, #fluorescent_2, #fluorescent_3, #fluorescent_4"),e=$('<div id="darkness_fill" />').appendTo(a).hide(),f=$('<div id="darkness_bg" />').appendTo(a).hide(),g=$('<div id="darkness_bg_light" />').appendTo(a).hide(),h=$('<div id="darkness_floor" />').appendTo(a).hide(),i=$('<div id="darkness_floor_light" />').appendTo(a).hide(),j=$('<div id="darkness_wires" />').appendTo(a).hide(),k=f.add(h).add(j);d.fadeOut();setTimeout(function(){k.add(e).delay(1e3).fadeIn(500,function(){f.transition({x:-10},1e4,"linear");j.transition({rotate:"10deg"},1e4,"linear");b.text_cloud("I guess I have no choice. I need to accept you.",4e3);c.text_cloud("I guess I have no choice. I need to accept you.",4e3);setTimeout(function(){b.text_cloud("But this time...",3e3);c.text_cloud("But this time...",3e3)},4e3);setTimeout(function(){b.text_cloud("I'll absorb you.",3e3)},8e3);k.delay(8e3).stop().transition({opacity:0},1e3);g.add(i).delay(8e3).fadeIn(1e3);setTimeout(function(){$("#no_click").css("background","transparent");c.fadeOut(1e3);sound_woosh.play();$('<div id="flash" />').appendTo(b).transition({scale:40,opacity:.7},2e3).transition({scale:100,opacity:1},500,function(){$("body").css("background","#fff");game.exit(3,3)})},13e3)})},1e3)}})})},no_click:function(a,b){a===!0?$("<div/>",{id:"no_click"}).appendTo("body").css("background",b):a===!1&&$("#no_click").remove()}};