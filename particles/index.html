<!DOCTYPE html>

<html>

	<title>Canvas Particles Test</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>

	<style>
		* {
			padding:0;
			margin:0;
		}
		body {
			background:#cef2f2;
		}
	</style>

	<script>
	particles = {

		settings: {
			WIDTH: window.innerWidth,
			HEIGHT: window.innerHeight,
			canvas_id: 'canvas',
			pxs: new Array(),
			rint: 24,

			particle_number: 100,
			dx: 'random',
			dy: 'random',
			deflect: false,

			// in seconds
			ttl: 20, 
			xmax: 5, 
			ymax: 2, 
			rmax: 10, 
			rt: 0, 
			xdef: window.innerWidth/2, 
			ydef: window.innerHeight/2, 
			xdrift: 4, 
			ydrift: 4, 
			random: true, 
			blink: false
		},

		init: function(settings) {
			$.extend(particles.settings, settings);

			//refresh canvas size according to window size
			if (particles.settings.WIDTH === window.innerWidth && particles.settings.HEIGHT === window.innerHeight)
			// setInterval(function() {
			// 	particles.settings.WIDTH = window.innerWidth;
			// 	particles.settings.HEIGHT = window.innerHeight;
			// }, 1000);

			var canvas = document.getElementById(particles.settings.canvas_id),
				con = canvas.getContext('2d');
			$(canvas).attr('width', particles.settings.WIDTH).attr('height', particles.settings.HEIGHT);

			for(var i = 0; i < particles.settings.particle_number; i++) {
				particles.settings.pxs[i] = new particles.Circle();
				particles.settings.pxs[i].reset();
			}

			setInterval(function() { particles.draw(con) }, particles.settings.rint);
		},

		draw: function(con) {
			con.clearRect(0,0,particles.settings.WIDTH,particles.settings.HEIGHT);
			for(var i = 0; i < particles.settings.pxs.length; i++) {
				particles.settings.pxs[i].fade();
				particles.settings.pxs[i].move();
				particles.settings.pxs[i].draw(con);
			}
		},

		Circle: function() {
			this.s = {
				ttl: particles.settings.ttl * 1000, 
				xmax: particles.settings.xmax, 
				ymax: particles.settings.ymax, 
				rmax: particles.settings.rmax, 
				rt: particles.settings.rt, 
				xdrift: particles.settings.xdrift, 
				ydrift: particles.settings.ydrift, 
				random: particles.settings.random, 
				blink: particles.settings.blink
			};

			this.reset = function() {
				this.x = particles.settings.xdef === 'random' ? particles.settings.WIDTH * Math.random() : particles.settings.xdef;
				this.y = particles.settings.ydef === 'random' ? particles.settings.HEIGHT * Math.random() : particles.settings.ydef;
				this.r = ((this.s.rmax-1)*Math.random()) + 1;
				this.dx = particles.settings.dx === 'random' ? (Math.random()*this.s.xmax) * (Math.random() < .1 ? -0.5 : 0.5) : particles.settings.dx;
				this.dy = particles.settings.dy === 'random' ? (Math.random()*this.s.ymax) * (Math.random() < .1 ? -0.5 : 0.5) : particles.settings.dy;
				this.hl = (this.s.ttl/particles.settings.rint)*(this.r/this.s.rmax);
				this.rt = Math.random()*this.hl;
				this.s.rt = Math.random()+1;
				this.stop = Math.random()*.2+.4;
				this.s.xdrift *= Math.random() * (Math.random() < .5 ? -1 : 1);
				this.s.ydrift *= Math.random() * (Math.random() < .5 ? -1 : 1);
			}

			this.fade = function() {
				this.rt += this.s.rt;
			}

			this.draw = function(con) {
				if(this.s.blink && (this.rt <= 0 || this.rt >= this.hl)) this.s.rt = this.s.rt*-1;
				else if(this.rt >= this.hl) this.reset();
				var newo = 1-(this.rt/this.hl);
				con.beginPath();
				con.arc(this.x,this.y,this.r,0,Math.PI*2,true);
				con.closePath();
				var cr = this.r*newo;
				g = con.createRadialGradient(this.x,this.y,0,this.x,this.y,(cr <= 0 ? 1 : cr));
				//g.addColorStop(0.0, 'rgba(255,255,255,' + newo + ')');
				g.addColorStop(this.stop, 'rgba(255, 255, 255, 1)');
				g.addColorStop(1.0, 'rgba(255, 255, 255, 0)');
				con.fillStyle = g;
				con.fill();
			}

			this.move = function() {
				this.x += Math.sin((this.rt/this.hl)*this.dx);
				this.y += Math.cos((this.rt/this.hl)*this.dy);
				if (particles.settings.deflect) {
					if(this.x > particles.settings.WIDTH || this.x < 0) this.dx *= -1;
					if(this.y > particles.settings.HEIGHT || this.y < 0) this.dy *= -1;
				}
			}

			this.getX = function() { return this.x; }
			this.getY = function() { return this.y; }
		}
	}

	$(document).ready(function() {
		particles.init({
			ttl:5,
			particle_number: 30,
			//dx: 1.5,
			dy: 2,
			xmax:1,
			xdrift:1,
			rt: 50
		});
	});

	</script>

<head>

</head>

<body>

	<canvas id="canvas"></canvas>

</body>

</html>